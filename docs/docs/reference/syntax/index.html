<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference/syntax">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.74/dist/themes/dark.css">
<script src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.74/dist/shoelace.js" type="module"></script><title data-rh="true">OpenGOAL Syntax &amp; Examples | OpenGOAL</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://open-goal.github.io/docs/reference/syntax"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="OpenGOAL Syntax &amp; Examples | OpenGOAL"><meta data-rh="true" name="description" content="The Basics"><meta data-rh="true" property="og:description" content="The Basics"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://open-goal.github.io/docs/reference/syntax"><link data-rh="true" rel="alternate" href="https://open-goal.github.io/docs/reference/syntax" hreflang="en"><link data-rh="true" rel="alternate" href="https://open-goal.github.io/docs/reference/syntax" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.09ceced1.css">
<link rel="preload" href="/assets/js/runtime~main.b80e7d5d.js" as="script">
<link rel="preload" href="/assets/js/main.1d3489b1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="OpenGOAL Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="OpenGOAL Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OpenGOAL</b></a><a class="navbar__item navbar__link" href="/progress">Progress</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/open-goal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">An Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/language-reference">Language Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;Language Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/type_system">OpenGOAL&#x27;s Type System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/method_system">OpenGOAL&#x27;s Method System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/reference/syntax">OpenGOAL Syntax &amp; Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/lib">Standard Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/reader">Reader</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/goos">GOOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/object_file_formats">Object File Formats</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/process_and_state">Process and State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/decompiler_states">States in the Decompiler</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/usage">Usage</a><button aria-label="Toggle the collapsible sidebar category &#x27;Usage&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/developing">Developing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/pc-port-info">PC Port Info</a><button aria-label="Toggle the collapsible sidebar category &#x27;PC Port Info&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/language-reference"><span itemprop="name">Language Reference</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">OpenGOAL Syntax &amp; Examples</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>OpenGOAL Syntax &amp; Examples</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-basics">The Basics<a class="hash-link" href="#the-basics" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="atoms">Atoms<a class="hash-link" href="#atoms" title="Direct link to heading">​</a></h3><p>An &quot;atom&quot; in Lisp is a form that can&#x27;t be broken down into smaller forms. For example <code>1234</code> is an atom, but <code>(1234 5678)</code> is not.  OpenGOAL supports the following atoms:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="integers">Integers<a class="hash-link" href="#integers" title="Direct link to heading">​</a></h3><p>All integers are by default <code>int</code>, a signed 64-bit integer. You can use:</p><ul><li>decimal: Like <code>123</code> or <code>-232</code>. The allowable range is <code>INT64_MIN</code> to <code>INT64_MAX</code>.</li><li>hex: Like <code>#x123</code>. The allowable range is <code>0</code> to <code>UINT64_MAX</code>. Values over <code>INT64_MAX</code> will wrap around.</li><li>binary: Like <code>#b10101010</code>. The range is the same as hex.</li><li>character:<ul><li>Most can be written like <code>#\c</code> for the character <code>c</code>.</li><li>Space is <code>#\\s</code></li><li>New Line is <code>#\\n</code></li><li>Tab is <code>#\\t</code></li></ul></li></ul><p>GOAL has some weird behavior when it comes to integers. It may seem complicated to describe, but it really makes the implementation simpler - the integer types are designed around the available MIPS instructions.</p><p>Integers that are used as local variables (defined with <code>let</code>), function arguments, function return values, and intermediate values when combining these are called &quot;register integers&quot;, as the values will be stored in CPU registers.</p><p>Integers that are stored in memory as a field of a <code>structure</code>/<code>basic</code>, an element in an array, or accessed through a <code>pointer</code> are &quot;memory integers&quot;, as the values will need to be loaded/stored from memory to access them.</p><p>The &quot;register integer&quot; types are <code>int</code> and <code>uint</code>. They are 64-bit and mostly work exactly like you&#x27;d expect. Multiplication, division, and mod, are a little weird and are documented separately.</p><p>The &quot;memory integer&quot; types are <code>int8</code>, <code>int16</code>, <code>int32</code>, <code>int64</code>, <code>uint8</code>, <code>uint16</code>, <code>uint32</code>, and <code>uint64</code>.</p><p>Conversions between these types are completely automatic - as soon as you access a &quot;memory integer&quot;, it will be converted to a &quot;register integer&quot;, and trying to store a &quot;register integer&quot; will automatically convert it to the appropriate &quot;memory integer&quot;. It (should be) impossible to accidentally get this wrong.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="side-note">Side Note<a class="hash-link" href="#side-note" title="Direct link to heading">​</a></h4><ul><li>It&#x27;s not clear what types <code>(new &#x27;static &#x27;integer)</code> or <code>(new &#x27;stack &#x27;integer)</code> are, though I would assume both are memory.</li><li>If there aren&#x27;t enough hardware registers, &quot;register integers&quot; can be spilled to stack, but keep their &quot;register integer&quot; types. This process should be impossible to notice, so you don&#x27;t have to worry about it.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="string">String<a class="hash-link" href="#string" title="Direct link to heading">​</a></h3><p>A string generates a static string constant. Currently the &quot;const&quot; of this string &quot;constant&quot; isn&#x27;t enforced. Creating two identical string constants creates two different string objects, which is different from GOAL and should be fixed at some point.</p><p>The string data is in quotes, like in C. The following escapes are supported:</p><ul><li>Newline: <code>\n</code></li><li>Tab: <code>\t</code></li><li>The <code>\</code> character: <code>\\</code></li><li>The <code>&quot;</code> character: <code>\&quot;</code></li><li>Any character: <code>\cXX</code> where <code>XX</code> is the hex number for the character.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="float">Float<a class="hash-link" href="#float" title="Direct link to heading">​</a></h3><p>Any number constant with a decimal in it. The trailing and leading zeros and negative sign is flexible, so you can do any of these:</p><ul><li><code>1.</code>, <code>1.0</code>, <code>01.</code>, <code>01.0</code></li><li><code>.1</code>, <code>0.1</code>, <code>.10</code>, <code>0.10</code></li><li><code>-.1</code>, <code>-0.1</code>, <code>-.10</code>, <code>-0.10</code></li></ul><p>Like string, it creates a static floating point constant. In later games the float was inlined instead of being a static constant.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="symbol">Symbol<a class="hash-link" href="#symbol" title="Direct link to heading">​</a></h3><p>Use <code>symbol-name</code> to get the value of a symbol and <code>&#x27;symbol-name</code> to get the symbol object.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="comments">Comments<a class="hash-link" href="#comments" title="Direct link to heading">​</a></h3><p>Use <code>;</code> for line comments and <code>#|</code> and <code>|#</code> for block comments.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="compiling-a-list">Compiling a list<a class="hash-link" href="#compiling-a-list" title="Direct link to heading">​</a></h2><p>When the compiler encounters a list like <code>(a b c)</code> it attempts to parse in multiple ways in this order:</p><ol><li>A compiler form</li><li>A GOOS macro</li><li>An enum (not yet implemented)</li><li>A function or method call</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="compiling-an-integer">Compiling an integer<a class="hash-link" href="#compiling-an-integer" title="Direct link to heading">​</a></h2><p>Integers can be specified as</p><ul><li>decimal: <code>1</code> or <code>-1234</code> (range of <code>INT64_MIN</code> to <code>INT64_MAX</code>)</li><li>hex: <code>#x123</code>, <code>#xbeef</code> (range of <code>0</code> to <code>UINT64_MAX</code>)</li><li>binary: <code>#b101010</code> (range of <code>0</code> to <code>UINT64_MAX</code>)</li></ul><p>All integers are converted to the signed &quot;integer in variable&quot; type called <code>int</code>, regardless of how they are specified.
Integer &quot;constant&quot;s are not stored in memory but instead are generated by code, so there&#x27;s no way to modify them.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="compiling-a-string">Compiling a string<a class="hash-link" href="#compiling-a-string" title="Direct link to heading">​</a></h2><p>A string constant can be specified by just putting it in quotes. Like <code>&quot;this is a string constant&quot;</code>.
There is an escape code <code>\</code> for string:</p><ul><li><code>\n</code> newline</li><li><code>\t</code> tab character</li><li><code>\\</code> the <code>\</code> character</li><li><code>\&quot;</code> the <code>&quot;</code> character</li><li><code>\cXX</code> where <code>XX</code> is a two character hex number: insert this character.</li><li>Any other character following a <code>\</code> is an error.</li></ul><p>OpenGOAL stores strings in the same segment of the function which uses the string. I believe GOAL does the same.</p><p>In GOAL, string constants are pooled per object file (or perhaps per segment)- if the same string appears twice, it is only included once. OpenGOAL currently does not pool strings. If any code is found that modifies a string &quot;constant&quot;, or if repeated strings take up too much memory, string pooling will be added.</p><p>For now I will assume that string constants are never modified.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="compiling-a-float">Compiling a float<a class="hash-link" href="#compiling-a-float" title="Direct link to heading">​</a></h2><p>A floating point constant is distinguished from an integer by a decimal point. Leading/trailing zeros are optional. Examples of floats: <code>1.0, 1., .1, -.1, -0.2</code>.  Floats are stored in memory, so it may be possible to modify a float constant. For now I will assume that float constants are never modified. It is unknown if they are pooled like strings.</p><p>Trivia: Jak 2 realized that it&#x27;s faster to store floats inline in the code.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="compiling-a-symbol">Compiling a symbol<a class="hash-link" href="#compiling-a-symbol" title="Direct link to heading">​</a></h2><p>A <code>symbol</code> appearing in code is compiled by trying each of these in the following order</p><ol><li>Is it <code>none</code>? (see section on <code>none</code>)</li><li>Try <code>mlet</code> symbols</li><li>Try &quot;lexical&quot; variables (defined in <code>let</code>)</li><li>Try global constants</li><li>Try global variables (includes named functions and all types)</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-special-none-type">The Special <code>none</code> type<a class="hash-link" href="#the-special-none-type" title="Direct link to heading">​</a></h2><p>Anything which doesn&#x27;t return anything has a return type of <code>none</code>, indicating the return value can&#x27;t be used.  This is similar to C&#x27;s <code>void</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="goal-structs-vs-c-structs">GOAL Structs vs. C Structs<a class="hash-link" href="#goal-structs-vs-c-structs" title="Direct link to heading">​</a></h2><p>There is one significant difference between C and GOAL when it comes to structs/classes - GOAL variables can only be references to structs.</p><p>As an example, consider a GOAL type <code>my-type</code> and a C type <code>my_type</code>.  In C/C++, a variable of type <code>my_type</code> represents an entire copy of a <code>my_type</code> object, and a <code>my_type*</code> is like a reference to an existing <code>my_type</code> object.  In GOAL, an object of <code>my-type</code> is a reference to an existing <code>my-type</code> object, like a C <code>my_type*</code>.  There is no equivalent to a C/C++ <code>my_type</code>.</p><p>As a result you cannot pass or return a structure by value.</p><p>Another way to explain this is that GOAL structures (including <code>pair</code>) always have reference semantics.  All other GOAL types have value semantics.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pointers">Pointers<a class="hash-link" href="#pointers" title="Direct link to heading">​</a></h2><p>GOAL pointers work a lot like C/C++ pointers, but have some slight differences:</p><ul><li>A C <code>int32_t*</code> is a GOAL <code>(pointer int32)</code></li><li>A C <code>void*</code> is a GOAL <code>pointer</code></li><li>In C, if <code>x</code> is a <code>int32_t*</code>, <code>x + 1</code> is equivalent to <code>uintptr_t(x) + sizeof(int32_t)</code>.  In GOAL, all pointer math is done in units of bytes.</li><li>In C, you can&#x27;t do pointer math on a <code>void*</code>. In GOAL you can, and all math is done in units of bytes.</li></ul><p>In both C and GOAL, there is a connection between arrays and pointers.  A GOAL array field will have a pointer-to-element type, and a pointer can be accessed as an array.</p><p>One confusing thing is that a <code>(pointer int32)</code> is a C <code>int32_t*</code>, but a <code>(pointer my-structure-type)</code> is a C <code>my_structure_type**</code>, because a GOAL <code>my-structure-type</code> is like a C <code>my_structure_type*</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="inline-arrays">Inline Arrays<a class="hash-link" href="#inline-arrays" title="Direct link to heading">​</a></h2><p>One limitation of the system above is that an array of <code>my_structure_type</code> is actually an array of references to structures (C <code>object*[]</code>).  It would be more efficient if instead we had an array of structures, laid out together in memory (C <code>object[]</code>).</p><p>GOAL has a &quot;inline array&quot; to represent this.  A GOAL <code>(inline-array thing)</code> is like a C <code>thing[]</code>. The inline-array can only be used on structure types, as these are the only reference types.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fields-in-structs">Fields in Structs<a class="hash-link" href="#fields-in-structs" title="Direct link to heading">​</a></h2><p>For a field with a reference type (structure/basic)</p><ul><li><code>(data thing)</code> is like C <code>Thing* data;</code></li><li><code>(data thing :inline #t)</code> is like C <code>Thing data;</code></li><li><code>(data thing 12)</code> is like C <code>Thing* data[12];</code>. The field has <code>(pointer thing)</code> type.</li><li><code>(data thing 12 :inline #t)</code> is like <code>Thing data[12];</code>. The field has <code>(inline-array thing)</code> type</li></ul><p>For a field with a value type (integer, etc)</p><ul><li><code>(data int32)</code> is like C <code>int32_t data;</code></li><li><code>(data int32 12)</code> is like <code>int32_t data[12];</code>. The field has <code>(array int32)</code> type.</li></ul><p>Using the <code>:inline #t</code> option on a value type is not allowed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-structs">Dynamic Structs<a class="hash-link" href="#dynamic-structs" title="Direct link to heading">​</a></h2><p>GOAL structure can be dynamically sized, which means their size isn&#x27;t determined at compile time. Instead the user should implement <code>asize-of</code> to return the actual size.</p><p>This works by having the structure end in an array of unknown size at compile time. In a dynamic structure definition, the last field of the struct should be an array with an unspecified size. To create this, add a <code>:dynamic #t</code> option to the field and do not specify an array size.  This can be an array of value types, an array of reference types, or an inline-array of reference types.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unknown">Unknown<a class="hash-link" href="#unknown" title="Direct link to heading">​</a></h3><p>Is the <code>size</code> of a dynamic struct:</p><ul><li>size assuming the dynamic array has 0 elements (I think it&#x27;s this)</li><li>size assuming the dynamic array doesn&#x27;t</li></ul><p>These can differ by padding for alignment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-create-goal-objects---new">How To Create GOAL Objects - <code>new</code><a class="hash-link" href="#how-to-create-goal-objects---new" title="Direct link to heading">​</a></h2><p>GOAL has several different ways to create objects, all using the <code>new</code> form.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="heap-allocated-objects">Heap Allocated Objects<a class="hash-link" href="#heap-allocated-objects" title="Direct link to heading">​</a></h3><p>A new object can be allocated on a heap with <code>(new &#x27;global &#x27;obj-type [new-method-arguments])</code>.
This simply calls the <code>new</code> method of the given type. You can also replace <code>&#x27;global</code> with <code>&#x27;debug</code> to allocate on the debug heap.
Currently these are the only two heaps supported, in the future you will be able to call the new method with other arguments
to allow you to do an &quot;in place new&quot; or allocate on a different heap.</p><p>This will only work on structures and basics. If you want a heap allocated float/integer/pointer, create an array of size 1.
This will work on dynamically sized items.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="heap-allocated-arrays">Heap Allocated Arrays<a class="hash-link" href="#heap-allocated-arrays" title="Direct link to heading">​</a></h3><p>You can construct a heap array with <code>(new &#x27;global &#x27;inline-array &#x27;obj-type count)</code> or <code>(new &#x27;global &#x27;array &#x27;obj-type count)</code>.
These objects are not initialized. Note that the <code>array</code> version creates a <code>(pointer obj-type)</code> plain array,
<strong>not</strong> a GOAL <code>array</code> type fancy array.  In the future this may change because it is confusing.</p><p>Because these objects are uninitialized, you cannot provide constructor arguments.
You cannot use this on dynamically sized member types. However, the array size can be determined at runtime.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="static-objects">Static Objects<a class="hash-link" href="#static-objects" title="Direct link to heading">​</a></h3><p>You can create a static object with <code>(new &#x27;static &#x27;obj-type [field-def]...)</code>. It can be a structure, basic, bitfield, array, boxed array, or inline array.
Each field def looks like <code>:field-name field-value</code>. The <code>field-value</code> is evaluated at compile time. Fields
can be integers, floats, symbols, pairs, strings, or other statics. These field values may come from macros or GOAL constants.</p><p>For bitfields, there is an exception, and fields can be set to expression that are not known at compile time.  The compiler will generate the appropriate code to combine the values known at compile time and run time. This exception does not apply to a bitfield inside of another <code>(new &#x27;static ...)</code>.</p><p>Fields which aren&#x27;t explicitly initialized are zeroed, except for the type field of basics, which is properly initialized to the correct type.</p><p>This does not work on dynamically sized structures.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stack-allocated-arrays">Stack Allocated Arrays<a class="hash-link" href="#stack-allocated-arrays" title="Direct link to heading">​</a></h3><p>Currently only arrays of integers, floats, or pointers can be stack allocated.
For example, use <code>(new &#x27;stack &#x27;&#x27;array &#x27;int32 1)</code> to get a <code>(pointer int32)</code>. Unlike heap allocated arrays, these stack arrays
must have a size that can be determined at compile time.  The objects are uninitialized.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stack-allocated-structures">Stack Allocated Structures<a class="hash-link" href="#stack-allocated-structures" title="Direct link to heading">​</a></h3><p>Works like heap allocated, the objects are initialized with the constructor. The constructor must support &quot;stack mode&quot;. Using <code>object-new</code> supports stack mode so usually you don&#x27;t have to worry about this.  The structure&#x27;s memory will be memset to 0 with <code>object-new</code> automatically.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="defining-a-new-method">Defining a <code>new</code> Method<a class="hash-link" href="#defining-a-new-method" title="Direct link to heading">​</a></h3><p>TODO</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="array-spacing">Array Spacing<a class="hash-link" href="#array-spacing" title="Direct link to heading">​</a></h2><p>In general, all GOAL objects are 16-byte aligned and the boxing system requires this.  All heap memory allocations are 16-byte aligned too, so this is usually not an issue.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="truth">Truth<a class="hash-link" href="#truth" title="Direct link to heading">​</a></h2><p>Everything is true except for <code>#f</code>. This means <code>0</code> is true, and <code>&#x27;()</code> is true.
The value of <code>#f</code> can be used like <code>nullptr</code>, at least for any <code>basic</code> object.  It&#x27;s unclear if <code>#f</code> can/should be used as a null for other types, including <code>structure</code>s or numbers or pointers.</p><p>Technical note: the hex number <code>0x147d24</code> is considered false in Jak 1 NTSC due to where the symbol table happened to be allocated.  However, checking numbers for true/false shouldn&#x27;t be done, you should use <code>(zero? x)</code> instead.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="empty-pair">Empty Pair<a class="hash-link" href="#empty-pair" title="Direct link to heading">​</a></h2><p>TODO</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/open-goal/open-goal.github.io/tree/master/documentation/reference/syntax.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/reference/method_system"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">OpenGOAL&#x27;s Method System</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/reference/lib"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Standard Library</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-basics" class="table-of-contents__link toc-highlight">The Basics</a><ul><li><a href="#atoms" class="table-of-contents__link toc-highlight">Atoms</a></li><li><a href="#integers" class="table-of-contents__link toc-highlight">Integers</a></li><li><a href="#string" class="table-of-contents__link toc-highlight">String</a></li><li><a href="#float" class="table-of-contents__link toc-highlight">Float</a></li><li><a href="#symbol" class="table-of-contents__link toc-highlight">Symbol</a></li><li><a href="#comments" class="table-of-contents__link toc-highlight">Comments</a></li></ul></li><li><a href="#compiling-a-list" class="table-of-contents__link toc-highlight">Compiling a list</a></li><li><a href="#compiling-an-integer" class="table-of-contents__link toc-highlight">Compiling an integer</a></li><li><a href="#compiling-a-string" class="table-of-contents__link toc-highlight">Compiling a string</a></li><li><a href="#compiling-a-float" class="table-of-contents__link toc-highlight">Compiling a float</a></li><li><a href="#compiling-a-symbol" class="table-of-contents__link toc-highlight">Compiling a symbol</a></li><li><a href="#the-special-none-type" class="table-of-contents__link toc-highlight">The Special <code>none</code> type</a></li><li><a href="#goal-structs-vs-c-structs" class="table-of-contents__link toc-highlight">GOAL Structs vs. C Structs</a></li><li><a href="#pointers" class="table-of-contents__link toc-highlight">Pointers</a></li><li><a href="#inline-arrays" class="table-of-contents__link toc-highlight">Inline Arrays</a></li><li><a href="#fields-in-structs" class="table-of-contents__link toc-highlight">Fields in Structs</a></li><li><a href="#dynamic-structs" class="table-of-contents__link toc-highlight">Dynamic Structs</a><ul><li><a href="#unknown" class="table-of-contents__link toc-highlight">Unknown</a></li></ul></li><li><a href="#how-to-create-goal-objects---new" class="table-of-contents__link toc-highlight">How To Create GOAL Objects - <code>new</code></a><ul><li><a href="#heap-allocated-objects" class="table-of-contents__link toc-highlight">Heap Allocated Objects</a></li><li><a href="#heap-allocated-arrays" class="table-of-contents__link toc-highlight">Heap Allocated Arrays</a></li><li><a href="#static-objects" class="table-of-contents__link toc-highlight">Static Objects</a></li><li><a href="#stack-allocated-arrays" class="table-of-contents__link toc-highlight">Stack Allocated Arrays</a></li><li><a href="#stack-allocated-structures" class="table-of-contents__link toc-highlight">Stack Allocated Structures</a></li><li><a href="#defining-a-new-method" class="table-of-contents__link toc-highlight">Defining a <code>new</code> Method</a></li></ul></li><li><a href="#array-spacing" class="table-of-contents__link toc-highlight">Array Spacing</a></li><li><a href="#truth" class="table-of-contents__link toc-highlight">Truth</a></li><li><a href="#empty-pair" class="table-of-contents__link toc-highlight">Empty Pair</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 OpenGOAL. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b80e7d5d.js"></script>
<script src="/assets/js/main.1d3489b1.js"></script>
</body>
</html>